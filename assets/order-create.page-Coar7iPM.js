import{a as ie,Q as ce,r as _,j as e}from"./index-XwE6gQmn.js";import{a as de,H as le}from"./Helmet-DUuvCvTm.js";import{z as i,u as me,t as ue,F as m}from"./index-MxbznExh.js";import{B as _e}from"./button-C4HOWXLM.js";import{C as pe,c as he}from"./card-BA5oHXKG.js";import{I as u}from"./input-BFqvYdSA.js";import{L as n}from"./label-DhoCOihp.js";import{T as xe}from"./textarea-pe7qWxdy.js";import{u as je,a as ge,F as ye,b as fe,c as ve,d as Ce,e as be}from"./use-calculate-manual.mutation-wFIPF1cQ.js";import{u as Ne}from"./use-auth.cache-CFuprbIQ.js";import{u as Se}from"./useMutation-Czv1wBp1.js";import{u as qe}from"./use-get-customers.query-CnOE94fL.js";import{F as Fe}from"./vn-bank.field-fT9-E9lv.js";import{u as Re,F as Oe}from"./create-customer-cc.feature-m4XxLmEW.js";import{u as ke}from"./use-get-customer-by-id.query-lOxLSuWh.js";import{u as T}from"./index-Dwx9NaXw.js";import{f as B}from"./format-currency-DwwnROlR.js";import{f as V}from"./format-percent-Ca7gawAv.js";import{F as Be}from"./order-step-2.form-CcCF4uq5.js";import"./select-BLsJIQQv.js";import"./react-icons.esm-5SUvy-NO.js";import"./Combination-WE48jzIv.js";import"./index-DWR91OCR.js";import"./index-CROUqNK7.js";import"./useQuery-BXJOiSOe.js";import"./index-CwCgg0f3.js";import"./use-get-user-options.query-B2W5Dekj.js";import"./use-get-vn-banks.query-F2BXTXzV.js";import"./popover-Bx3-hur5.js";import"./index-DrW2nO8L.js";import"./dialog-Cq2VxrqT.js";import"./dialog-button.component-msJRMg9P.js";import"./customer-cc.form-BKGJk0nI.js";import"./convert-data-to-form-data.util-CYcIkezp.js";import"./use-cancel-order.mutation-CIf40CLb.js";import"./upload.constant-D3d5R5uO.js";import"./alert-dialog-BeURQn3I.js";function Me(p){return de({method:"post",url:"/customer_history/order_step1",data:p})}function Pe(){const{mutateAsync:p}=Se({mutationFn:Me,onSuccess:j=>{j.status&&ie.invalidateQueries({queryKey:ce.CUSTOMER_HISTORY})}});return{mutationCreateOrderStep1:p}}const we=i.object({card_type:i.string({required_error:"Required."}),user_option:i.coerce.number({required_error:"Required."}).gt(0,"Required."),rate_option:i.coerce.number({required_error:"Required."}).gt(0,"Required."),id_customer_info:i.coerce.number({required_error:"Required."}).gt(0,"Required."),id_pos_info:i.coerce.number({required_error:"Required."}).gt(0,"Required."),id_customer_creditcard:i.coerce.number({required_error:"Required."}).gt(0,"Required."),id_users:i.coerce.number({required_error:"Required."}).gt(0,"Required."),id_vietnamese_bank:i.coerce.number({required_error:"Required."}).gt(0,"Required."),days_coming_due:i.coerce.number({required_error:"Required."}),percent_to_charge:i.coerce.number({required_error:"Required."}).gt(0,"Required."),money_total:i.coerce.number({required_error:"Required."}).gt(0,"Required."),money_applied_percent:i.coerce.number({required_error:"Required."}).gt(0,"Required."),note:i.string()});function Ee({nextStep:p}){const{auth:j}=Ne(),[d,v]=_.useState("customer"),[y,b]=_.useState(),[Q,I]=_.useState(),[c,C]=_.useState(),[s,N]=_.useState(),[S,q]=_.useState(),[F,L]=_.useState(),[M,U]=_.useState(),[H,P]=_.useState(""),[A,G]=_.useState("1"),{register:t,handleSubmit:K,getValues:h,reset:w,formState:{errors:l}}=me({defaultValues:{days_coming_due:30,id_customer_creditcard:0,id_customer_info:0,id_pos_info:0,id_vietnamese_bank:0,money_applied_percent:"",money_total:"",note:"",percent_to_charge:0,rate_option:2,user_option:2,id_users:j==null?void 0:j.id},resolver:ue(we)}),{mutationCalculateManual:Y}=je(),{mutationCalculateByLevelRate:D}=ge(),{mutationCreateOrderStep1:z}=Pe(),J=async r=>{const a=await z(r);a.status&&p&&p(a)},{customers:R,refetchCustomers:W}=qe(y),{customer:x}=ke(Q),{customerCcs:O,refetchCustomerCcs:X}=Re(y),Z=r=>{b(r.target.value)},$=r=>{b(""),w(),C(void 0),q(void 0),N(void 0),t("id_customer_info").onChange({target:{name:"id_customer_info",value:r.id}}),C(r)},ee=r=>{b(""),w(),C(void 0),q(void 0),t("id_customer_info").onChange({target:{name:"id_customer_info",value:r.id_customer_info}}),t("id_customer_creditcard").onChange({target:{name:"id_customer_creditcard",value:r.id}}),N(r),I(r.id_customer_info)};async function k(r){const a=h("money_total"),g=h("rate_option"),f=h("percent_to_charge");let o={status:!1,fee:0,rate:f,result:0};r&&r==="2"||!r&&g===2?o=await D({money_total:a}):f>0&&(o=await Y({money_total:a,percent_to_charge:String(f)})),o!=null&&o.status&&(L(o==null?void 0:o.fee),P(String(o==null?void 0:o.rate)),t("percent_to_charge").onChange({target:{name:"percent_to_charge",value:String(o==null?void 0:o.rate)}}),t("money_applied_percent").onChange({target:{name:"money_applied_percent",value:String(o.result)}}))}const E=r=>{var g;const a=(g=c==null?void 0:c.list_credit_card)==null?void 0:g.find(f=>f.id===Number(r));N(a),t("id_vietnamese_bank").onChange({target:{name:"id_vietnamese_bank",value:a==null?void 0:a.id_vietnamese_bank}})},re=(r,a)=>{q(r),a&&U(a)},te=r=>{G(r),k(r)},se=r=>{t("money_total").onChange(r),k()},ae=r=>{t("percent_to_charge").onChange(r),P(r.target.value)},ne=()=>k();T(()=>{d==="customer"?W():X()},[y,d]),T(()=>{var r;if(x&&d==="credit_card"){x.list_credit_card=x==null?void 0:x.list_customer_creditcard,C(x);const a=(r=c==null?void 0:c.list_credit_card)==null?void 0:r.find(g=>g.id===Number(s==null?void 0:s.id));t("id_vietnamese_bank").onChange({target:{name:"id_vietnamese_bank",value:a==null?void 0:a.id_vietnamese_bank}})}},[x==null?void 0:x.id,s==null?void 0:s.id,d,E]);const oe=d==="customer"?"Name or Phone":"Credit card number";return e.jsxs("form",{onSubmit:K(J),className:"grid grid-cols-1 lg:grid-cols-2 gap-4 max-w-2xl mx-auto",autoComplete:"off",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:col-span-2",children:[e.jsx("div",{children:e.jsxs(n,{className:"items-center flex gap-1",children:[e.jsx("input",{name:"searchBy",type:"radio",value:"customer",checked:d==="customer",onChange:()=>v("customer")})," ","Search by Customer"]})}),e.jsx("div",{children:e.jsxs(n,{className:"items-center flex gap-1",children:[e.jsx("input",{name:"searchBy",type:"radio",value:"credit_card",checked:d==="credit_card",onChange:()=>v("credit_card")})," ","Search by Credit card"]})})]}),e.jsxs("div",{className:"lg:col-span-2 relative",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{placeholder:oe,value:y,onChange:Z,className:"flex-1"}),d==="credit_card"&&e.jsx(Oe,{})]}),y&&e.jsx(pe,{className:"absolute top-full mt-2 left-0 w-full",children:e.jsxs(he,{className:"max-h-80 p-2 overflow-auto",children:[d==="credit_card"&&(O==null?void 0:O.map(r=>e.jsxs("div",{className:"flex items-center gap-2 hover:bg-muted p-1 px-2 cursor-pointer",onClick:()=>ee(r),children:[e.jsx("strong",{children:r.name_on_creditcard})," (",r.creditcard_number,")"]},r.id))),d==="customer"&&(R==null?void 0:R.map(r=>e.jsxs("div",{className:"flex items-center gap-2 hover:bg-muted p-1 px-2 cursor-pointer",onClick:()=>$(r),children:[e.jsx("strong",{children:r.full_name})," (",r.phonenumber,")"]},r.id)))]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"customer",children:"Customer full name"}),e.jsx(u,{readOnly:!0,defaultValue:c==null?void 0:c.full_name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"id_customer_creditcard",children:"Credit Card"}),e.jsxs("div",{children:[c?e.jsx(ye,{...t("id_customer_creditcard"),value:s!=null&&s.id?String(s==null?void 0:s.id):"",listCustomerCreditcards:c==null?void 0:c.list_credit_card,onSelectCard:E}):e.jsx(u,{readOnly:!0}),M&&e.jsxs("p",{className:"italic mt-1 text-xs",children:["Last percent charge:"," ",e.jsx("strong",{children:V(M/100)})]})]}),e.jsx(m,{error:l.id_customer_creditcard})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"id_pos_info",children:"POS"}),s?e.jsx(fe,{...t("id_pos_info"),idCustomerCreditcard:s==null?void 0:s.id,onSelectPos:re}):e.jsx(u,{readOnly:!0}),e.jsx(m,{error:l.id_pos_info})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"id_vietnamese_bank",children:"Bank"}),s?e.jsx(Fe,{name:t("id_vietnamese_bank").name,onChange:t("id_vietnamese_bank").onChange,onBlur:t("id_vietnamese_bank").onBlur,readOnly:!0,defaultValue:s!=null&&s.id_vietnamese_bank?String(s.id_vietnamese_bank):void 0}):e.jsx(u,{readOnly:!0}),e.jsx(m,{error:l.id_vietnamese_bank})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"money_total",children:"Total Money"}),e.jsxs("div",{children:[e.jsx(u,{...t("money_total"),onChange:se}),e.jsx("p",{className:"p-2 text-sm italic",children:isNaN(Number(h("money_total")))?" ":B(Number(h("money_total")))})]}),e.jsx(m,{error:l.money_total})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"customer",children:"Max Usage Money"}),e.jsx(u,{readOnly:!0,defaultValue:S==null?void 0:S.max_per_charge})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"user_option",children:"User Option"}),e.jsx(ve,{...t("user_option"),defaultValue:"2"}),e.jsx(m,{error:l.user_option})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"rate_option",children:"Rate Option"}),e.jsx(Ce,{...t("rate_option"),defaultValue:"2",onSelectRate:te}),e.jsx(m,{error:l.rate_option})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"percent_to_charge",children:"Percent to Charge"}),e.jsxs("div",{children:[e.jsx(u,{...t("percent_to_charge"),value:H,onChange:ae,onBlur:ne,readOnly:A==="2"}),e.jsx("p",{className:"p-2 text-sm italic",children:isNaN(Number(h("percent_to_charge")))?" ":V(Number(h("percent_to_charge"))/100)})]}),e.jsx(m,{error:l.percent_to_charge})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"fee",children:"Fee"}),e.jsxs("div",{children:[e.jsx(u,{readOnly:!0,value:F}),e.jsx("p",{className:"p-2 text-sm italic",children:isNaN(Number(F))?" ":B(Number(F))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"money_applied_percent",children:"Total Money Applied Percent"}),e.jsxs("div",{children:[e.jsx(u,{...t("money_applied_percent"),value:h("money_applied_percent"),readOnly:!0}),e.jsx("p",{className:"p-2 text-sm italic",children:isNaN(Number(h("money_applied_percent")))?" ":B(Number(h("money_applied_percent")))})]}),e.jsx(m,{error:l.money_applied_percent})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"days_coming_due",children:"Days Coming Due"}),e.jsx(u,{...t("days_coming_due")}),e.jsx(m,{error:l.days_coming_due})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"card_type",children:"Card Type"}),e.jsx(be,{...t("card_type")}),e.jsx(m,{error:l.card_type})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"note",children:"Note"}),e.jsx(xe,{...t("note")}),e.jsx(m,{error:l.note})]}),e.jsx("div",{className:"lg:col-span-2 mt-4",children:e.jsx(_e,{className:"w-full",children:"Submit"})})]})}function Te(){const[p,j]=_.useState();function d(v){j(v)}return e.jsxs("div",{className:"space-y-4 px-4 mb-10",children:[e.jsx("h2",{className:"text-2xl lg:text-3xl font-bold tracking-tight space-y-2 max-w-2xl mx-auto",children:"Create Order"}),!p&&e.jsx(Ee,{nextStep:d}),p&&e.jsx(Be,{resultStep1:p})]})}function fr(){return e.jsxs(e.Fragment,{children:[e.jsx(le,{children:e.jsx("title",{children:"POS System - Order Create"})}),e.jsx(Te,{})]})}export{fr as default};
