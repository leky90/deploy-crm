import{j as e,R as c,r as u,Q as v,k as I,D as C}from"./index-XwE6gQmn.js";import{R as T}from"./role-redirect.component-B-7d_oPr.js";import{u as k,D as w}from"./index-BsOMOp0z.js";import{S as g,g as E,a as R,f as V,D as N}from"./statistic-card.component-CUJkCRU4.js";import{u as F,a as P}from"./use-get-user-options.query-B2W5Dekj.js";import{u as U}from"./use-get-statuses.query-C8V2J_-G.js";import{u as H}from"./use-get-vn-banks.query-F2BXTXzV.js";import{I as A,E as Q}from"./react-icons.esm-5SUvy-NO.js";import{B as _}from"./badge-DmV7fwsG.js";import{B as S}from"./button-C4HOWXLM.js";import{D as B}from"./dialog-Cq2VxrqT.js";import{C as d}from"./cell-currency-D6tOSgAE.js";import{C as b}from"./cell-percent-DV96QzFN.js";import{C as o}from"./cell-text-H3JibL2T.js";import{D as L}from"./dialog-button.component-msJRMg9P.js";import{L as G}from"./label-DhoCOihp.js";import{C as M}from"./cell-bank-ajtKXmsI.js";import{C as m}from"./cell-link-Dxt7hr8a.js";import{F as Y}from"./customer-cc-info.feature-mi_TeN3z.js";import{F as z}from"./customer-info.feature-Dk8ocKy_.js";import{f as p}from"./format-currency-DwwnROlR.js";import{u as q}from"./useQuery-BXJOiSOe.js";import{a as X,H as J}from"./Helmet-DUuvCvTm.js";import"./use-auth.cache-CFuprbIQ.js";import"./Combination-WE48jzIv.js";import"./index-DWR91OCR.js";import"./index-CROUqNK7.js";import"./select-BLsJIQQv.js";import"./dropdown-menu-oMbE38VB.js";import"./index-Dwx9NaXw.js";import"./popover-Bx3-hur5.js";import"./card-BA5oHXKG.js";import"./index-CwCgg0f3.js";import"./index-DrW2nO8L.js";import"./format-percent-Ca7gawAv.js";import"./get-yes-no.util-C-N_EnQX.js";import"./use-get-customer-cc-by-id.query-ajBfmNNj.js";import"./use-get-customer-by-id.query-lOxLSuWh.js";function O({row:i,userOptions:l,rateOptions:s,statuses:n,vnBanks:t}){return e.jsx("div",{className:"grid grid-cols-[200px_1fr] gap-4 max-h-96 px-4 overflow-auto items-center",children:i.getAllCells().map(r=>{let a=e.jsx(o,{children:r.getValue()});if(r.column.id!=="actions"){switch(r.column.id){case"id_customer_info":a=e.jsx(m,{to:c.CUSTOMER_DETAIL.replace(":id",r.getValue()),children:r.getValue()});break;case"id_customer_creditcard":a=e.jsx(m,{to:c.CUSTOMER_CC_DETAIL.replace(":id",r.getValue()),children:r.getValue()});break;case"id_pos_info":a=e.jsx(m,{to:c.STATISTICS_POS_USED.replace(":id",r.getValue()),children:r.getValue()});break;case"id_vietnamese_bank":a=e.jsx(M,{value:r.getValue(),vnBanks:t});break;case"status":a=e.jsxs(e.Fragment,{children:[e.jsx(_,{variant:n==null?void 0:n[r.getValue()].status,children:n==null?void 0:n[r.getValue()].status}),e.jsxs("p",{className:"italic text-xs mt-2 flex gap-2",children:[e.jsx(A,{className:"w-4 mt-0.5"})," ",n==null?void 0:n[r.getValue()].description]})]});break;case"user_option":a=e.jsx(o,{children:l==null?void 0:l[r.getValue()].name});break;case"rate_option":a=e.jsx(o,{children:s==null?void 0:s[r.getValue()].name});break;case"is_bank_payment_complete":a=e.jsx(_,{variant:r.getValue()?"success":"destructive",children:r.getValue()?"Đã chuyển":"Chưa chuyển"});break;case"percent_to_charge":a=e.jsx(b,{value:r.getValue()/100});break;case"money_total":case"money_applied_percent":case"fee":a=e.jsx(d,{value:r.getValue()});break}return e.jsxs(u.Fragment,{children:[e.jsx(G,{className:"text-muted-foreground",children:r.column.columnDef.header}),e.jsx("div",{children:a})]},r.id)}})})}const W={id:!0,card_type:!0,date_coming_due:!0,date_due:!1,date_withdrawn:!0,days_coming_due:!0,fee:!0,id_customer_creditcard:!1,id_customer_info:!1,id_pos_info:!1,id_users:!1,id_vietnamese_bank:!1,images_creditcard_due_withdrawn:!1,images_transfer_money_to_customer:!1,is_bank_payment_complete:!0,last_update:!1,money_applied_percent:!0,money_total:!0,note:!1,percent_to_charge:!0,rate_option:!0,status:!0,time_insert:!1,user_option:!0,uuid_id:!1,tid_pos:!1},Z=({userOptions:i,rateOptions:l,statuses:s,vnBanks:n})=>[{accessorKey:"id",header:"ID",enableHiding:!1,cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"uuid_id",header:"UUID",cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"id_users",header:"User ID",cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"rate_option",header:"Rate option",cell:t=>{var r;return e.jsx(o,{children:(r=l==null?void 0:l[t.getValue()])==null?void 0:r.name})}},{accessorKey:"user_option",header:"User option",cell:t=>{var r;return e.jsx(o,{children:(r=i==null?void 0:i[t.getValue()])==null?void 0:r.name})}},{accessorKey:"status",header:"Status",cell:t=>{var r,a;return e.jsx(_,{variant:(r=s==null?void 0:s[t.getValue()])==null?void 0:r.status,children:(a=s==null?void 0:s[t.getValue()])==null?void 0:a.status})}},{accessorKey:"id_customer_creditcard",header:"Customer CCID",cell:t=>e.jsx(Y,{id:t.getValue()})},{accessorKey:"id_customer_info",header:"Customer Info ID",cell:t=>e.jsx(z,{id:t.getValue()})},{accessorKey:"tid_pos",header:"POS TID",cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"id_pos_info",header:"POS ID",cell:t=>e.jsx(m,{to:c.STATISTICS_POS_USED.replace(":id",t.getValue()),children:t.getValue()})},{accessorKey:"id_vietnamese_bank",header:"Bank Name",cell:t=>{var r;return e.jsx(o,{children:(r=n==null?void 0:n[t.getValue()])==null?void 0:r.short_name})}},{accessorKey:"is_bank_payment_complete",header:"Is bank payment complete?",cell:t=>e.jsx(_,{variant:t.getValue()?"success":"destructive",children:t.getValue()?"Đã chuyển":"Chưa chuyển"})},{accessorKey:"date_due",header:"Date due",cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"date_coming_due",header:"Date coming due",cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"days_coming_due",header:"Days coming due",cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"date_withdrawn",header:"Date withdrawn",cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"card_type",header:"Card type",cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"money_total",header:"Revenue",cell:t=>e.jsx(d,{value:t.getValue()})},{accessorKey:"percent_to_charge",header:"Percent to charge",cell:t=>e.jsx(b,{value:t.getValue()/100})},{accessorKey:"fee",header:"Fee",cell:t=>e.jsx(d,{value:t.getValue()})},{accessorKey:"money_applied_percent",header:"Net profit",cell:t=>e.jsx(d,{value:t.getValue()})},{accessorKey:"note",header:"Note",cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"last_update",header:"Last update",cell:t=>e.jsx(o,{children:t.getValue()})},{accessorKey:"time_insert",header:"Created time",cell:t=>e.jsx(o,{children:t.getValue()})},{id:"actions",enableHiding:!1,cell:({row:t})=>e.jsx(L,{title:"Detail Info",description:"Detail info's statistic customer history.",className:"max-w-3xl",trigger:e.jsx(S,{variant:"outline",size:"icon",children:e.jsx(Q,{})}),actionButtons:e.jsx(B,{asChild:!0,children:e.jsx(S,{type:"button",variant:"secondary",children:"Close"})}),children:e.jsx(O,{row:t,userOptions:i,rateOptions:l,statuses:s,vnBanks:n})})}];function $({totalRevenue:i,totalNetProfit:l,totalFee:s}){return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsx(g,{label:"Total Revenue",value:p(i)}),e.jsx(g,{label:"Total Net Profit",value:p(l)}),e.jsx(g,{label:"Total Fee",value:p(s)})]})}function ee(i){return X({url:"/statistics/Get_Customer_History_By_Date",params:i})}function te(i){const l=["BY_DATE",i._from,i._to,i.page,i.page_limit].join("_"),{data:s}=q({queryKey:[...v.CUSTOMER_HISTORY,l],queryFn:()=>ee(i),placeholderData:I,gcTime:1e3*10});return{customerHistoryByDate:s}}function re(){const[i,l]=u.useState({from:E(30),to:R()}),[s,n]=u.useState({pageIndex:0,pageSize:10}),[t,r]=k("statistic-customer-history-columns",{defaultValue:W}),{customerHistoryByDate:a}=te({_from:V(i.from||new Date,C),_to:V(i.to||new Date,C),page:s.pageIndex+1,page_limit:s.pageSize}),{userOptionsByKey:h}=F(),{rateOptionsByKey:x}=P(),{statusesByKey:f}=U(),{vnBanksByKey:y}=H(),D=u.useMemo(()=>Z({userOptions:h,rateOptions:x,statuses:f,vnBanks:y}),[h,x,f,y]),K=(j,...ae)=>{j&&l(j)};return e.jsxs("div",{className:"space-y-6 px-4 py-4",children:[e.jsxs("div",{className:"flex items-center flex-col lg:flex-row justify-between space-y-2",children:[e.jsx("h2",{className:"text-2xl lg:text-3xl font-bold tracking-tight",children:"Statistic Customer History"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(N,{date:i,onSelect:K})})]}),e.jsx($,{totalRevenue:a==null?void 0:a.money_total_in_date,totalNetProfit:a==null?void 0:a.money_applied_percent_in_date,totalFee:a==null?void 0:a.fee_in_date}),e.jsx(w,{data:a==null?void 0:a.result,columns:D,columnVisibility:t,rowCount:a==null?void 0:a.total_data,pagination:s,onColumnVisibilityChange:r,onPaginationChange:n})]})}function Le(){return e.jsxs(T,{type:"admin",children:[e.jsx(J,{children:e.jsx("title",{children:"POS System - Statistic Customer History"})}),e.jsx(re,{})]})}export{Le as default};
