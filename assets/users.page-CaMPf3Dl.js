import{a as j,Q as p,j as e,r as x}from"./index-XwE6gQmn.js";import{a as g,H as U}from"./Helmet-DUuvCvTm.js";import{R as C}from"./role-redirect.component-B-7d_oPr.js";import{T as b,a as v,b as w,c as F,u as R,D as V}from"./index-BsOMOp0z.js";import{C as i}from"./cell-text-H3JibL2T.js";import{g as _,a as D}from"./get-status.util-DC1d3cyY.js";import{B as k}from"./badge-DmV7fwsG.js";import{U as A,P as B}from"./react-icons.esm-5SUvy-NO.js";import{B as m}from"./button-C4HOWXLM.js";import{u as f}from"./useMutation-Czv1wBp1.js";import{A as E,a as K,b as T,c as N,d as P,e as I,f as q,g as Q,h as M}from"./alert-dialog-BeURQn3I.js";import{u as H}from"./useQuery-BXJOiSOe.js";import{k as L}from"./index-CwCgg0f3.js";import{D as W}from"./dialog-button.component-msJRMg9P.js";import{D as z}from"./dialog-Cq2VxrqT.js";import{z as a,u as Y,t as G,F as l}from"./index-MxbznExh.js";import{I as d}from"./input-BFqvYdSA.js";import{S as O,a as J,b as X,c as Z,d as $}from"./select-BLsJIQQv.js";import{L as u}from"./label-DhoCOihp.js";import{R as ee}from"./role.component-D8MaKBYp.js";import"./use-auth.cache-CFuprbIQ.js";import"./Combination-WE48jzIv.js";import"./index-DWR91OCR.js";import"./index-CROUqNK7.js";import"./dropdown-menu-oMbE38VB.js";import"./index-Dwx9NaXw.js";import"./index-DrW2nO8L.js";function re(r){return g({method:"patch",url:"/user/set_active",data:r})}function se(){const{mutateAsync:r}=f({mutationFn:re,onSettled:()=>{j.invalidateQueries({queryKey:p.USERS})}});return{mutationUpdateUserStatusById:r}}function te({status:r,id:t}){const{mutationUpdateUserStatusById:n}=se(),s=()=>{n({id_user:t,active:!r})};return e.jsx(b,{children:e.jsxs(v,{children:[e.jsx(w,{children:e.jsxs(E,{children:[e.jsx(K,{asChild:!0,children:e.jsx(m,{variant:"outline",size:"icon",children:e.jsx(A,{})})}),e.jsxs(T,{children:[e.jsxs(N,{children:[e.jsx(P,{children:"Changing status"}),e.jsxs(I,{children:["Confirm to change user status to"," ",r?"inactive":"active"]})]}),e.jsxs(q,{children:[e.jsx(Q,{children:"Cancel"}),e.jsx(M,{onClick:s,children:"Confirm"})]})]})]})}),e.jsx(F,{children:e.jsxs("p",{children:["Change user to ",r?"inactive":"active","."]})})]})})}const ne={id:!0,active:!0,full_name:!0,public_id:!1,role:!0,token:!1,username:!0,working_address:!0,phonenumber:!0},ae=()=>[{accessorKey:"id",header:"ID",enableHiding:!1,cell:r=>e.jsx(i,{children:r.getValue()})},{accessorKey:"username",header:"Username",cell:r=>e.jsx(i,{children:r.getValue()})},{accessorKey:"full_name",header:"Full Name",cell:r=>e.jsx(i,{children:r.getValue()})},{accessorKey:"role",header:"Role",cell:r=>e.jsx(i,{children:_(r.getValue())})},{accessorKey:"active",header:"Status",cell:r=>e.jsxs("div",{className:"space-x-2 truncate",children:[e.jsx(k,{variant:r.getValue()?"success":"destructive",children:D(r.getValue())}),e.jsx(te,{id:r.row.original.id,status:r.getValue()})]})},{accessorKey:"phonenumber",header:"Phone",cell:r=>e.jsx(i,{children:r.getValue()})},{accessorKey:"working_address",header:"Working Address",cell:r=>e.jsx(i,{children:r.getValue()})}];function oe(){return g({url:"/user/get_all"})}function ie(){const{data:r}=H({queryKey:p.USERS,queryFn:oe,gcTime:1e4}),t=x.useMemo(()=>r!=null&&r.status?L(r.result,"id"):{},[r==null?void 0:r.status]);return{users:r==null?void 0:r.result,usersByKey:t}}const le=a.object({id:a.coerce.number().optional(),role:a.coerce.number({invalid_type_error:"Required."}).min(1,"Required.").max(2,"Required."),username:a.string().nonempty(),full_name:a.string().nonempty(),password:a.string().nonempty(),phonenumber:a.string(),working_address:a.string().nonempty()});function ue({defaultValues:r,mutation:t,onClose:n}){const{register:s,handleSubmit:y,formState:{errors:o}}=Y({defaultValues:r,resolver:G(le)}),S=async c=>{(await t(c)).status&&n&&n()};return e.jsxs("form",{onSubmit:y(S),className:"space-y-4",autoComplete:"off",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"username",children:"Username"}),e.jsx(d,{placeholder:"Username",...s("username")}),e.jsx(l,{error:o.username})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"fullname",children:"Full name"}),e.jsx(d,{placeholder:"Full name",...s("full_name")}),e.jsx(l,{error:o.full_name})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"password",children:"Password"}),e.jsx(d,{type:"password",placeholder:"Password",...s("password")}),e.jsx(l,{error:o.password})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"role",children:"Role"}),e.jsxs(O,{...s("role"),defaultValue:"1",onValueChange:c=>s("role").onChange({target:{name:"role",value:c}}),children:[e.jsx(J,{className:"h-8 w-20",children:e.jsx(X,{placeholder:"Set role"})}),e.jsx(Z,{children:[{role:"User",value:"1"},{role:"Admin",value:"2"}].map(({role:c,value:h})=>e.jsx($,{value:h,children:c},h))})]}),e.jsx(l,{error:o.role})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"phonenumber",children:"Phone number"}),e.jsx(d,{placeholder:"Phone number",...s("phonenumber")}),e.jsx(l,{error:o.phonenumber})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"working_address",children:"Working address"}),e.jsx(d,{placeholder:"Working address",...s("working_address")}),e.jsx(l,{error:o.working_address})]}),e.jsx(m,{className:"w-full",children:"Submit"})]})}function ce(r){return g({url:"/user/signup",method:"post",data:r})}function de(){const{mutateAsync:r}=f({mutationFn:ce,onSuccess:t=>{t.status&&j.invalidateQueries({queryKey:p.USERS})}});return{mutationSignUp:r}}function me(){const r=x.useRef(null);function t(){var s;(s=r.current)==null||s.click()}const{mutationSignUp:n}=de();return e.jsx(ee,{type:"admin",children:e.jsx(W,{title:"Create new user",className:"w-96",trigger:e.jsxs(m,{className:"gap-2",children:[e.jsx(B,{})," Create new user"]}),actionButtons:e.jsx(z,{asChild:!0,children:e.jsx(m,{ref:r,type:"button",variant:"secondary",children:"Close"})}),children:e.jsx(ue,{defaultValues:{role:1},onClose:t,mutation:n})})})}function he(){const[r,t]=R("user-columns",{defaultValue:ne}),{users:n}=ie(),s=x.useMemo(()=>ae(),[]);return e.jsxs("div",{className:"space-y-6 px-4 py-4",children:[e.jsxs("div",{className:"flex items-center flex-col lg:flex-row justify-between space-y-2",children:[e.jsx("h2",{className:"text-2xl lg:text-3xl font-bold tracking-tight",children:"Users"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(me,{})})]}),e.jsx(V,{data:n,columns:s,columnVisibility:r,rowCount:n==null?void 0:n.length,onColumnVisibilityChange:t,hidePagination:!0})]})}function Qe(){return e.jsxs(C,{type:"admin",children:[e.jsx(U,{children:e.jsx("title",{children:"POS System - List of Users"})}),e.jsx(he,{})]})}export{Qe as default};
